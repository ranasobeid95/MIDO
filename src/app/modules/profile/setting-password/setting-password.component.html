<div class="settings" [class.blur]="loading">
  <h2 class="title">Change Password</h2>
  <form class="form" [formGroup]="passwordForm">
    <div class="form__field">
      <label class="label">Current Password</label>
      <mat-form-field>
        <mat-icon
          class="password-icon"
          appShowHidePassword
          [target]="currentPass"
        ></mat-icon>
        <input
          matInput
          type="password"
          formControlName="currentPassword"
          autocomplete="on"
          #currentPass
        />
        <mat-hint
          >Should be at least 6 characters include(Capital & number)</mat-hint
        >
        <mat-error *ngIf="f.currentPassword.hasError('required')"
          >Password is required</mat-error
        >
        <mat-error
          *ngIf="
            !f.currentPassword.hasError('required') &&
            f.currentPassword.hasError('passwordWeak')
          "
          >Password must be at least 6 characters include(Capital & number)
        </mat-error>
      </mat-form-field>
    </div>
    <div class="line"></div>
    <div class="form__field">
      <label class="label">New Password</label>
      <mat-form-field>
        <mat-icon
          class="password-icon"
          appShowHidePassword
          [target]="newPass"
        ></mat-icon>
        <input
          matInput
          type="password"
          formControlName="newPassword"
          autocomplete="on"
          #newPass
        />
        <mat-hint
          >Should be at least 6 characters include(Capital & number)</mat-hint
        >
        <mat-error *ngIf="f.newPassword.hasError('required')"
          >Password is required</mat-error
        >
        <mat-error
          *ngIf="
            !f.newPassword.hasError('required') &&
            f.newPassword.hasError('passwordWeak')
          "
          >Password must be at least 6 characters include(Capital & number)
        </mat-error>
      </mat-form-field>
    </div>
    <div class="form__field">
      <label class="label">Confirm Password</label>
      <mat-form-field>
        <mat-icon
          class="password-icon"
          appShowHidePassword
          [target]="confirmPass"
        ></mat-icon>
        <input
          matInput
          type="password"
          formControlName="confirmPassword"
          autocomplete="on"
          #confirmPass
        />
        <mat-error>newPassword & confirm didn't match. Try again</mat-error>
      </mat-form-field>
    </div>
    <div class="form__controls">
      <mat-error *ngIf="!!error" class="error">{{ error }}</mat-error>
      <button
        (click)="onSubmit()"
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="passwordForm.invalid || loading"
      >
        Save Changes
      </button>
      <div *ngIf="showPopup" class="popup">
        <p class="message">
          This operation is sensitive and requires recent authentication. Log in
          again before retrying this request!!!
        </p>
        <div class="controls">
          <button (click)="onLogout()" class="me-3" mat-raised-button>
            Logout
          </button>
          <button (click)="showPopup = false" mat-raised-button>Cancel</button>
        </div>
      </div>
    </div>
  </form>
</div>
<mat-spinner *ngIf="loading" class="spinner"></mat-spinner>
